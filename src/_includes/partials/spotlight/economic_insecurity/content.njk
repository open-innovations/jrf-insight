{% set this_place = search.page('place key=' + geography) %}

<h3>Broad datasets</h3>

<p>The following datasets reflect the experience across the population of {{ this_place.title }}.</p>

{% comp 'layout.tab.set' %}
{#------------------------------------------------------------------------
      ECONOMIC ACTIVITY
   -------------------------------------------------------------------------#}
{% comp 'layout.tab.panel', { label: 'Economic Activity', id: 'economic-activity' } %}
{% set chart_data = dataset
  .labour_market
  .get_economic_activity_for_place(geography) %}
{% if chart_data.rows | length > 0 %}
  {{ comp.oi.chart.line({
    config: {
      data: chart_data,
      legend: { show: true },
      axis: {
        x: { title: { label: "Year" }, grid: { show: true } },
        y: { title: { label: "% of population" }, grid: { show: true }, tick: { spacing: 5 }, min: 0 }
      },
      series: [
        {
          x: "date", y: "Unemployment rate - aged 16-64",
          title: "Unemployment rate", line: { 'stroke-width': 5 }, points: { size: 10 }
        },
        {
          x: "date", y: "% who are economically inactive - aged 16-64",
          title: "Economic inactivity rate", line: { 'stroke-width': 5 }, points: { size: 10 }
        }
      ]
    }
  }) | safe }}
{% else %}
  <p>No data available at this level</p>
{% endif %}

{% endcomp %}

{% comp 'layout.tab.panel', { label: 'Fuel poverty', id: 'fuel-poverty' } %}
{% set chart_data = dataset
  .fuel_poverty
  .get_fuel_poverty_for_place(geography) %}
<pre style="font-size: 0.7em;">{{ chart_data | dump(2) }}</pre>
{% endcomp %}

{% comp 'layout.tab.panel', { label: 'Weekly earning', id: 'weekly-earning' } %}

{% endcomp %}

{% comp 'layout.tab.panel', { label: 'Savings and investments', id: 'savings-investments' } %}
{% set chart_data = dataset
  .savings
  .get_savings_and_investments_for_place(geography) %}
{% if chart_data.rows | length > 0 %}

  <a href="https://github.com/open-innovations/jrf-insight/blob/main/data/hbai/Savings%20and%20Investments%20of%20Adults%20in%20the%20Family%20of%20the%20Individual.csv">Savings and Investments</a>
  <p style="text-align: center;">Savings and investments of adults in the family for low income households</p>
  {{ comp.oi.chart.line({
    config: {
      legend: { show: true },
      data: chart_data,
      axis: {
        x: { title: { label: "Year" } },
        y: {
          title: { label: "Percent of population" }, grid: { show: true },
          tick: { spacing: 5 }, min: 0, max: 20
        }
      },
      series: [
        {
          title: "No savings", x: "date", y: "No savings",
          line: { 'stroke-width': 5 }, points: { size: 10 }
        },
        {
          title: "Less than £1,500",
          x: "date",
          y: "Less than £1,500",
          line: { 'stroke-width': 5 }, points: { size: 10 }
        },
        {
          title: "£1,500 but less than £3,000",
          x: "date",
          y: "£1,500 but less than £3,000",
          line: { 'stroke-width': 5 }, points: { size: 10 }
        },
        {
          title: "£3,000 but less than £8,000",
          x: "date",
          y: "£3,000 but less than £8,000",
          line: { 'stroke-width': 5 }, points: { size: 10 }
        },
        {
          title: "£8,000 but less than £10,000",
          x: "date",
          y: "£8,000 but less than £10,000",
          line: { 'stroke-width': 5 }, points: { size: 10 }
        }
      ]
    }
  }) | safe }}
{% endif %}
{% endcomp %}

{% endcomp %}

<h3>Specific Demographics</h3>

{% comp 'layout.tab.set' %}
{% comp 'layout.tab.panel', { label: 'Gender - pay gap / % jobs less than living wage' } %}
{% endcomp %}
{% comp 'layout.tab.panel', {label: 'Ethnicity'} %}
{% endcomp %}
{% comp 'layout.tab.panel', {label: 'Single parents'} %}
{% endcomp %}
{% comp 'layout.tab.panel', {label: 'Carers'} %}
{% endcomp %}
{% endcomp %}

<p>
See also https://www.jrf.org.uk/report/economic-security-foundation-dignity-opportunity-and-hope-age-uncertainty
</p>

{% set savings = this_place_data['households_low_income_no_savings'] %}
{% set imd_average_score = this_place_data['imd_average_score'] %}
{% set claimants = this_place_data['Claimants as a proportion of residents aged 16-64'] %}
{% set median_weekly_wage = this_place_data['median_weekly_wage'] %}
{% set mean_weekly_wage = this_place_data['mean_weekly_wage'] %}
{% set fuel_poverty = this_place_data['Proportion of households fuel poor (%)'] %}
{% set geo = geography %}

{{ top_trump_table(
  name="spotlight statistics",
  style="top-trump-table top-trump-invert",
  columns= [
      {
        name: 'Low income households with no savings or investments', 
        data: savings, 
        simple_data: null
      },
      {
        name: 'IMD average score', 
        data: imd_average_score, 
        simple_data: null
      },
      {
        name: 'Claimants as a proportion of residents aged 16-64 (UC & JSA)', 
        data: claimants, 
        simple_data: null
      },
      {
        name: 'Mean weekly wage (£)', 
        data: mean_weekly_wage, 
        simple_data: null
      },
      {
        name: 'Median weekly wage (£)', 
        data: median_weekly_wage, 
        simple_data: null
      }
      ]
  ) 
}}

{# {% comp 'layout.two_column' %}
    {{ comp.info.headline({
        number: savings,
        display: savings,
        description: 'Number of households with no savings or investments'
        }) | safe }}
    {{ comp.info.headline({
        number: imd_average_score,
        display: imd_average_score,
        description: 'IMD - average score'
        }) | safe }}
    {{ comp.info.headline({
        number: claimants,
        display: claimants,
        description: 'Claimants as a percentage of residents aged 16-64 (JSA and UC)'
        }) | safe }}
{% endcomp %} #}


<ul>
  <li>
    <a href="https://github.com/open-innovations/jrf-insight/tree/main/data/imd">IMD</a>
  </li>
</ul>