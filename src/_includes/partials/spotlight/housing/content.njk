{% set ct_pensioners = this_place_data['council_tax_pensioners'] %}
{% set ct_working_age = this_place_data['council_tax_working_age'] %}
{% set smi_loans_in_payment_households = this_place_data['smi_loans_in_payment_households'] %}
{% set homeless = this_place_data['Total households assessed as owed a duty'] %}
{% set housing_benefit = this_place_data['HB_claimants'] %}
{% set number_of_households = this_place_data['Number of households'] %}
{% set housing_benefit_norm = (100*this_place_data['HB_claimants'] / this_place_data['Number of households']) | round(1) %}
{% set house_prices = this_place_data['Median house price'] %}

{% comp 'layout.stack' %}
{% comp 'layout.two_column' %}
    {{ comp.info.headline({
        number: house_prices,
        display: house_prices,
        description: 'Median house price (£)'
        }) | safe }}
    {{ comp.info.headline({
        number: ct_working_age,
        display: ct_working_age,
        description: 'Number of working-age people claiming council tax support'
        }) | safe }}
    {{ comp.info.headline({
        number: ct_pensioners,
        display: ct_pensioners,
        description: 'Number of pensioners claiming council tax support'
        }) | safe }}
    {{ comp.info.headline({
        number: homeless,
        display: homeless,
        description: 'Households assessed as homeless'
        }) | safe }}
    {{ comp.info.headline({
        number: smi_loans_in_payment_households,
        display: smi_loans_in_payment_households,
        description: 'Number of people with support with mortgage interest'
        }) | safe }}
    {{ comp.info.headline({
        number: housing_benefit_norm,
        display: housing_benefit_norm,
        description: 'Percentage of households receiving housing benefit'
        }) | safe }}
{% endcomp %}
{% endcomp %}
<ul>
    <li>Household Income</li>
    <li>Fuel poverty</li>
    <li>Overcrowding</li>
    <li><a href="https://github.com/open-innovations/jrf-insight/blob/main/data/hbai/Tenure%20Type%20of%20the%20Household%20of%20the%20Individual.csv">Tenure type</a></li>
    <li><a href="https://github.com/open-innovations/jrf-insight/tree/main/data/council-tax-support">Council tax support</a></li>
</ul>

{% set geo = geography %}
{% comp 'layout.two_column' %}
{% if geo in time_series.house_prices.names %}
    {{ comp.oi.chart.line({
      config: {
        legend: { 
          show: true
        },
        data: query.house_prices_for_place(geo),
        axis: {
          x: {
            title: {
              label: "Year"
            }
          },
          y: {
            title: {
              label: "Median House Prices (£)"
            },
            grid: {
              show: true
            },
            tick: {
              spacing: 50000
            },
            min: 0,
            max: 300000
          }
        },
        series: [
          {
            title: this_place_data.name,
            x: "date",
            y: geo,
            colour: "#13242F",
            line: {
              "stroke-dasharray": "0 10"
            }
          }
        ]
      }
    })| safe
  }}
{% endif %}
{% if geo in bar_charts.current_rental_prices.names %}
  {{comp.oi.chart.bar({
    config: {
      data: query.current_rental_prices_for_place(geo),
      stacked: false,
      legend: { 
        show: true
      },
      category: "property_code",
      series: [
        {
        "title": this_place_data.name,  
        "value": geo,
        "colour": "#13242F"
        }
      ], 
      axis: {
        x: {
          tick: {
            spacing: 400
          }
        }
      }
    }
    }) | safe
  }}
{% endif %}
{% endcomp %}
<p> test </p>

{% set chart_data = time_series.individual(geo) %}
{% if chart_data.rows | length > 0 %}
    {{ comp.oi.chart.line({
      config: {
        legend: { 
          show: true
        },
        data: chart_data,
        axis: {
          x: {
            title: {
              label: "Year"
            }
          },
          y: {
            title: {
              label: "Number of households in low income"
            },
            grid: {
              show: true
            },
            tick: {
              spacing: 50000
            },
            min: 0,
            max: 1000000
          }
        },
        series: [
          {
            title: "Child",
            x: "Financial Year",
            y: "Child",
            colour: "#13242F",
            line: {
              "stroke-dasharray": "0 10"
            }
          },
          {
            title: "Working Age",
            x: "Financial Year",
            y: "Working-Age",
            colour: "#13242F",
            line: {
              "stroke-dasharray": "0 15"
            }
          },
          {
            title: "Pensioner",
            x: "Financial Year",
            y: "Pensioner",
            colour: "#13242F",
            line: {
              "stroke-dasharray": "0 20"
            }
          }
        ]
      }
    })| safe
  }}
{% endif %}